<roblox xmlns:xmime="http://www.w3.org/2005/05/xmlmime" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://www.roblox.com/roblox.xsd" version="4">
	<External>null</External>
	<External>nil</External>
	<Item class="Tool" referent="RBXD8D69573844A4190BF4B98503E5F62E8">
		<Properties>
			<bool name="CanBeDropped">true</bool>
			<bool name="Enabled">true</bool>
			<CoordinateFrame name="Grip">
				<X>0</X>
				<Y>0</Y>
				<Z>-1.5</Z>
				<R00>0</R00>
				<R01>0</R01>
				<R02>1</R02>
				<R10>1</R10>
				<R11>0</R11>
				<R12>0</R12>
				<R20>0</R20>
				<R21>1</R21>
				<R22>0</R22>
			</CoordinateFrame>
			<bool name="ManualActivationOnly">false</bool>
			<string name="Name">Illumina</string>
			<Content name="TextureId"><url>http://www.roblox.com/asset/?id=16620737 </url></Content>
			<string name="ToolTip">Illumina</string>
		</Properties>
		<Item class="Part" referent="RBX3A4E1513687B4FB880C59E586BE957C4">
			<Properties>
				<bool name="Anchored">false</bool>
				<float name="BackParamA">-0.5</float>
				<float name="BackParamB">0.5</float>
				<token name="BackSurface">0</token>
				<token name="BackSurfaceInput">0</token>
				<float name="BottomParamA">-0.5</float>
				<float name="BottomParamB">0.5</float>
				<token name="BottomSurface">0</token>
				<token name="BottomSurfaceInput">0</token>
				<int name="BrickColor">1001</int>
				<CoordinateFrame name="CFrame">
					<X>0</X>
					<Y>2</Y>
					<Z>0</Z>
					<R00>0.00096754462</R00>
					<R01>-0.923925817</R01>
					<R02>0.382570565</R02>
					<R10>0.761063218</R10>
					<R11>0.248845309</R11>
					<R12>0.599048257</R12>
					<R20>-0.648676991</R20>
					<R21>0.290580779</R21>
					<R22>0.703406692</R22>
				</CoordinateFrame>
				<bool name="CanCollide">true</bool>
				<float name="Elasticity">0.5</float>
				<float name="Friction">0.300000012</float>
				<float name="FrontParamA">-0.5</float>
				<float name="FrontParamB">0.5</float>
				<token name="FrontSurface">0</token>
				<token name="FrontSurfaceInput">0</token>
				<float name="LeftParamA">-0.5</float>
				<float name="LeftParamB">0.5</float>
				<token name="LeftSurface">0</token>
				<token name="LeftSurfaceInput">0</token>
				<bool name="Locked">true</bool>
				<token name="Material">1088</token>
				<string name="Name">Handle</string>
				<float name="Reflectance">0.699999988</float>
				<float name="RightParamA">-0.5</float>
				<float name="RightParamB">0.5</float>
				<token name="RightSurface">0</token>
				<token name="RightSurfaceInput">0</token>
				<Vector3 name="RotVelocity">
					<X>0</X>
					<Y>0</Y>
					<Z>0</Z>
				</Vector3>
				<float name="TopParamA">-0.5</float>
				<float name="TopParamB">0.5</float>
				<token name="TopSurface">0</token>
				<token name="TopSurfaceInput">0</token>
				<float name="Transparency">0</float>
				<Vector3 name="Velocity">
					<X>0</X>
					<Y>0</Y>
					<Z>0</Z>
				</Vector3>
				<token name="formFactorRaw">2</token>
				<token name="shape">1</token>
				<Vector3 name="size">
					<X>1</X>
					<Y>0.800000012</Y>
					<Z>4</Z>
				</Vector3>
			</Properties>
			<Item class="SpecialMesh" referent="RBX6904C8A68DEA4EBD87E3500F2B444B98">
				<Properties>
					<token name="LODX">2</token>
					<token name="LODY">2</token>
					<Content name="MeshId"><url>rbxasset://fonts/sword.mesh</url></Content>
					<token name="MeshType">5</token>
					<string name="Name">Mesh</string>
					<Vector3 name="Offset">
						<X>0</X>
						<Y>0</Y>
						<Z>0</Z>
					</Vector3>
					<Vector3 name="Scale">
						<X>1</X>
						<Y>1</Y>
						<Z>1</Z>
					</Vector3>
					<Content name="TextureId"><null></null></Content>
					<Vector3 name="VertexColor">
						<X>1</X>
						<Y>1</Y>
						<Z>0</Z>
					</Vector3>
				</Properties>
			</Item>
			<Item class="Sparkles" referent="RBXDC703CE7319C4B2CB2F9332AA0790A07">
				<Properties>
					<bool name="Enabled">true</bool>
					<string name="Name">IlluminaSparkles</string>
					<Color3 name="SparkleColor">4287633919</Color3>
				</Properties>
			</Item>
			<Item class="Sound" referent="RBXFD7250FDE737461091C84701C22090C3">
				<Properties>
					<bool name="Looped">false</bool>
					<string name="Name">LungeSound</string>
					<float name="Pitch">1</float>
					<bool name="PlayOnRemove">false</bool>
					<Content name="SoundId"><url>rbxasset://sounds/swordlunge.wav</url></Content>
					<float name="Volume">0.600000024</float>
				</Properties>
			</Item>
			<Item class="Sound" referent="RBXF24A178856E8421F890B9B877C207138">
				<Properties>
					<bool name="Looped">false</bool>
					<string name="Name">SlashSound</string>
					<float name="Pitch">1</float>
					<bool name="PlayOnRemove">false</bool>
					<Content name="SoundId"><url>rbxasset://sounds/swordslash.wav</url></Content>
					<float name="Volume">0.699999988</float>
				</Properties>
			</Item>
			<Item class="Sound" referent="RBX11425B2A75A84FAE8A3DAA1B7B5AAD8A">
				<Properties>
					<bool name="Looped">false</bool>
					<string name="Name">UnsheathSound</string>
					<float name="Pitch">1</float>
					<bool name="PlayOnRemove">false</bool>
					<Content name="SoundId"><url>rbxasset://sounds/unsheath.wav</url></Content>
					<float name="Volume">1</float>
				</Properties>
			</Item>
			<Item class="Script" referent="RBXDE2BED503F2C46C4803FC970848CEF0E">
				<Properties>
					<bool name="Disabled">false</bool>
					<Content name="LinkedSource"><null></null></Content>
					<string name="Name">ThumbnailHelper</string>
					<ProtectedString name="Source"><![CDATA[script.Parent.BrickColor = BrickColor.new'Dark stone grey'
script:Destroy()]]></ProtectedString>
				</Properties>
			</Item>
		</Item>
		<Item class="Script" referent="RBX4D7AE4DDF5014F99BDD0BA9084EB8E36">
			<Properties>
				<bool name="Disabled">false</bool>
				<Content name="LinkedSource"><null></null></Content>
				<string name="Name">Script</string>
				<ProtectedString name="Source"><![CDATA[--[[
	Rewritten by ArceusInator
	- Completely rewrote the sword
	- Added a Configurations folder so damage settings can be easily modified
	- The sword runs on the client in non-FE to reduce the impression of input delay
	- Fixed the floaty lunge issue
	
	This script will run the sword code on the server if filtering is enabled
--]]
local Tool = script.Parent
local GLib = require(206209239)
local GLibScript = GLib.Script
GLibScript.Name = 'GLib'
GLibScript.Parent = Tool
local Sword = require(Tool:WaitForChild'Sword')

if workspace.FilteringEnabled then
	-- Run the sword code on the server and accept input from the client
	
	Sword:Initialize()
	
	Tool:WaitForChild'RemoteClick'.OnServerEvent:connect(function(client, action)
		if client.Character == Tool.Parent then
			Sword:Attack()
		end
	end)
end]]></ProtectedString>
			</Properties>
		</Item>
		<Item class="LocalScript" referent="RBXA62AD436F97845E1AC30CC36E7C2E17B">
			<Properties>
				<bool name="Disabled">false</bool>
				<Content name="LinkedSource"><null></null></Content>
				<string name="Name">LocalScript</string>
				<ProtectedString name="Source"><![CDATA[--[[
	Rewritten by ArceusInator
	
	This script will run the sword code on the client if filtering is disabled
--]]
local Tool = script.Parent
local Sword = require(Tool:WaitForChild'Sword')

if not workspace.FilteringEnabled then
	-- Run the sword code on the client
	
	Sword:Initialize()
end

Tool.Equipped:connect(function(mouse)
	mouse.Button1Down:connect(function()
		if workspace.FilteringEnabled then
			-- Send input info to the server
			Tool.RemoteClick:FireServer()
		else
			-- Interpret it on the client
			Sword:Attack()
		end
	end)
end)]]></ProtectedString>
			</Properties>
		</Item>
		<Item class="RemoteEvent" referent="RBXC5B34C72551A40569E1AD744FAD1964A">
			<Properties>
				<string name="Name">RemoteClick</string>
			</Properties>
		</Item>
		<Item class="ModuleScript" referent="RBXFA01ABB599C444FAA8C36B83A53C7A75">
			<Properties>
				<Content name="LinkedSource"><null></null></Content>
				<string name="Name">Sword</string>
				<ProtectedString name="Source"><![CDATA[--[[
	Rewritten by ArceusInator
	
	This script is the Sword module.  This runs on either the server (when FilteringEnabled is on) or the client (when FilteringEnabled is off)
--]]
local Tool = script.Parent
local Handle = Tool.Handle
local Config = Tool:WaitForChild'Configurations'
local Sword = {
	-- Advanced settings
	DoubleClickMaxTime = 0.2,
	
	-- Variables
	State = 'Idle', -- Idle, Slashing, Lunging
	SlashingStartedAt = 0,
	AttackTicket = 0,
}

local GLib = require(Tool:WaitForChild'GLib') -- Library of useful functions

--
--
function Sword:Connect()
	Handle.Touched:connect(function(hit)
		local myPlayer = GLib.GetPlayerFromPart(Tool)
		local character, player, humanoid = GLib.GetCharacterFromPart(hit)
		
		if myPlayer~=nil and character~=nil and humanoid~=nil and myPlayer~=player then
			local isTeammate = GLib.IsTeammate(myPlayer, player)
			local myCharacter = myPlayer.Character
			local myHumanoid = myCharacter and myCharacter:FindFirstChild'Humanoid'
			
			if (Config.CanTeamkill.Value==true or isTeammate~=true) and (myHumanoid and myHumanoid:IsA'Humanoid' and myHumanoid.Health > 0) and (Config.CanKillWithForceField.Value or myCharacter:FindFirstChild'ForceField'==nil) then
				local doDamage = Config.IdleDamage.Value
				if Sword.State == 'Slashing' then
					doDamage = Config.SlashDamage.Value
				elseif Sword.State == 'Lunging' then
					doDamage = Config.LungeDamage.Value
				end
				
				GLib.TagHumanoid(humanoid, myPlayer, 1)
				humanoid:TakeDamage(doDamage)
			end
		end
	end)
	
	Tool.Equipped:connect(function()
		equipped = true
		while equipped do
			Sword:RevealNearbyPlayers()
			wait(0.25)
		end
	end)
	Tool.Unequipped:connect(function()
		equipped = false
	end)
end

function Sword:Attack()
	local myCharacter, myPlayer, myHumanoid = GLib.GetCharacterFromPart(Tool)
	
	if myHumanoid~=nil and myHumanoid.Health > 0 then
		if Config.CanKillWithForceField.Value or myCharacter:FindFirstChild'ForceField'==nil then
			local now = tick()
			
			if Sword.State == 'Slashing' and now-Sword.SlashingStartedAt < Sword.DoubleClickMaxTime then
				Sword.AttackTicket = Sword.AttackTicket+1
				
				Sword:Lunge(Sword.AttackTicket)
			elseif Sword.State == 'Idle' then
				Sword.AttackTicket = Sword.AttackTicket+1
				Sword.SlashingStartedAt = now
				
				Sword:Slash(Sword.AttackTicket)
			end
		end
	end
end

function Sword:Slash(ticket)
	Sword.State = 'Slashing'
	
	Handle.SlashSound:Play()
	Sword:Animate'Slash'
	
	wait(0.5)
	
	if Sword.AttackTicket == ticket then
		Sword.State = 'Idle'
	end
end

function Sword:Lunge(ticket)
	Sword.State = 'Lunging'
	
	Handle.LungeSound:Play()
	Sword:Animate'Lunge'
	
	local force = Instance.new'BodyVelocity'
	force.velocity = Vector3.new(0, 80, 0)
	force.maxForce = Vector3.new(0, 4000, 0)
	force.Parent = Tool.Parent:FindFirstChild'HumanoidRootPart' or Tool.Parent.Torso
	
	wait(0.25)
	Tool.Grip = CFrame.new(0, 0, -1.5, 0, -1, -0, -1, 0, -0, 0, 0, -1)
	force.velocity = force.Parent.CFrame.lookVector*120 + Vector3.new(0, 60, 0)
	wait(0.5)
	force:Destroy()
	wait(0.5)
	Tool.Grip = CFrame.new(0, 0, -1.5, 0, 0, 1, 1, 0, 0, 0, 1, 0)
	
	Sword.State = 'Idle'
end

function Sword:Animate(name)
	local tag = Instance.new'StringValue'
	tag.Name = 'toolanim'
	tag.Value = name
	tag.Parent = Tool -- Tag gets removed by the animation script
end

function Sword:RevealNearbyPlayers()
	local me = GLib.GetPlayerFromPart(Tool)
	local PlayersAvailable = game:GetService'Players':GetPlayers()
	for i, v in pairs(PlayersAvailable) do
		if not GLib.IsTeammate(me, v) then
			local character = v.Character
			if character then
				local humanoid = character:FindFirstChild("Humanoid")
				local torso = character:FindFirstChild("Torso")
				if v and v.Character and v.Character ~= me.Character and humanoid and torso then
					if (torso.Position - Handle.Position).magnitude < 32 then
						for i, v in pairs(character:GetChildren()) do
							if v:IsA("BasePart") and v.Name ~= "HumanoidRootPart" and v.Transparency > 0 then
								local sparkles = GLib.Create'Sparkles'{
									Name = 'Illumina_RevealingSparkles',
									Parent = v,
									SparkleColor = Color3.new(144/255, 25/255, 255/255)
								}
								
								delay(0.25, function()
									sparkles.Enabled = false
									
									delay(1, function()
										sparkles:Destroy()
									end)
								end)
							end
						end
					end
				end
			end
		end
	end
end

--
function Sword:Initialize()
	Sword:Connect()
end

--
--
return Sword]]></ProtectedString>
			</Properties>
		</Item>
		<Item class="Configuration" referent="RBX1D108315C85B46AF9E4ADE9DA86E0717">
			<Properties>
				<string name="Name">Configurations</string>
			</Properties>
			<Item class="BoolValue" referent="RBX9DA94D34E07246709EE253005824707E">
				<Properties>
					<string name="Name">CanTeamkill</string>
					<bool name="Value">false</bool>
				</Properties>
			</Item>
			<Item class="IntValue" referent="RBX6BBF23A5C0974FE89316CE03184D08C2">
				<Properties>
					<string name="Name">IdleDamage</string>
					<int name="Value">10</int>
				</Properties>
			</Item>
			<Item class="IntValue" referent="RBX3582413DFBE64227AFACE4FB497D3355">
				<Properties>
					<string name="Name">SlashDamage</string>
					<int name="Value">20</int>
				</Properties>
			</Item>
			<Item class="IntValue" referent="RBX425E7AC2717A4ACEAE6D4FF45552B33F">
				<Properties>
					<string name="Name">LungeDamage</string>
					<int name="Value">40</int>
				</Properties>
			</Item>
			<Item class="BoolValue" referent="RBXC19262DD7BD34FA59357D57B3921E6B5">
				<Properties>
					<string name="Name">CanKillWithForceField</string>
					<bool name="Value">true</bool>
				</Properties>
			</Item>
		</Item>
		<Item class="Camera" referent="RBX25342BE4B20C4A4E86459A176BAA4424">
			<Properties>
				<Ref name="CameraSubject">null</Ref>
				<token name="CameraType">0</token>
				<CoordinateFrame name="CoordinateFrame">
					<X>-18.5833931</X>
					<Y>2.50875044</Y>
					<Z>-0.261957318</Z>
					<R00>-0.0151642617</R00>
					<R01>0.0241452791</R01>
					<R02>-0.999593496</R02>
					<R10>-0</R10>
					<R11>0.999708414</R11>
					<R12>0.0241480563</R12>
					<R20>0.999884963</R20>
					<R21>0.000366187451</R21>
					<R22>-0.0151598407</R22>
				</CoordinateFrame>
				<float name="FieldOfView">10</float>
				<CoordinateFrame name="Focus">
					<X>0.00747871399</X>
					<Y>2.05963445</Y>
					<Z>0.0199919641</Z>
					<R00>1</R00>
					<R01>0</R01>
					<R02>0</R02>
					<R10>0</R10>
					<R11>1</R11>
					<R12>0</R12>
					<R20>0</R20>
					<R21>0</R21>
					<R22>1</R22>
				</CoordinateFrame>
				<string name="Name">ThumbnailCamera</string>
			</Properties>
		</Item>
	</Item>
</roblox>