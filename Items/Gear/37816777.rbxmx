<roblox xmlns:xmime="http://www.w3.org/2005/05/xmlmime" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://www.roblox.com/roblox.xsd" version="4">
	<External>null</External>
	<External>nil</External>
	<Item class="Tool" referent="RBX8C334104B6DE4C368854F925D0D59A14">
		<Properties>
			<bool name="CanBeDropped">true</bool>
			<bool name="Enabled">true</bool>
			<CoordinateFrame name="Grip">
				<X>0</X>
				<Y>0</Y>
				<Z>-1.5</Z>
				<R00>0</R00>
				<R01>0</R01>
				<R02>1</R02>
				<R10>1</R10>
				<R11>0</R11>
				<R12>0</R12>
				<R20>0</R20>
				<R21>1</R21>
				<R22>0</R22>
			</CoordinateFrame>
			<bool name="ManualActivationOnly">false</bool>
			<string name="Name">Ghostwalker</string>
			<Content name="TextureId"><url>http://www.roblox.com/asset/?id=37755007</url></Content>
			<string name="ToolTip">Ghostwalker</string>
		</Properties>
		<Item class="Part" referent="RBXA564FF85EFF441D192FB12F1F7D093DE">
			<Properties>
				<bool name="Anchored">false</bool>
				<float name="BackParamA">-0.5</float>
				<float name="BackParamB">0.5</float>
				<token name="BackSurface">0</token>
				<token name="BackSurfaceInput">0</token>
				<float name="BottomParamA">-0.5</float>
				<float name="BottomParamB">0.5</float>
				<token name="BottomSurface">0</token>
				<token name="BottomSurfaceInput">0</token>
				<int name="BrickColor">1</int>
				<CoordinateFrame name="CFrame">
					<X>0</X>
					<Y>2.70000005</Y>
					<Z>0</Z>
					<R00>-0.659560978</R00>
					<R01>0.634408534</R01>
					<R02>0.403118253</R02>
					<R10>0.667998135</R10>
					<R11>0.248843998</R11>
					<R12>0.701323807</R12>
					<R20>0.344612211</R20>
					<R21>0.731848001</R21>
					<R22>-0.587912023</R22>
				</CoordinateFrame>
				<bool name="CanCollide">true</bool>
				<float name="Elasticity">0.5</float>
				<float name="Friction">0.300000012</float>
				<float name="FrontParamA">-0.5</float>
				<float name="FrontParamB">0.5</float>
				<token name="FrontSurface">0</token>
				<token name="FrontSurfaceInput">0</token>
				<float name="LeftParamA">-0.5</float>
				<float name="LeftParamB">0.5</float>
				<token name="LeftSurface">0</token>
				<token name="LeftSurfaceInput">0</token>
				<bool name="Locked">false</bool>
				<token name="Material">256</token>
				<string name="Name">Handle</string>
				<float name="Reflectance">0</float>
				<float name="RightParamA">-0.5</float>
				<float name="RightParamB">0.5</float>
				<token name="RightSurface">0</token>
				<token name="RightSurfaceInput">0</token>
				<Vector3 name="RotVelocity">
					<X>0</X>
					<Y>0</Y>
					<Z>0</Z>
				</Vector3>
				<float name="TopParamA">-0.5</float>
				<float name="TopParamB">0.5</float>
				<token name="TopSurface">0</token>
				<token name="TopSurfaceInput">0</token>
				<float name="Transparency">0.699999988</float>
				<Vector3 name="Velocity">
					<X>0</X>
					<Y>0</Y>
					<Z>0</Z>
				</Vector3>
				<token name="formFactorRaw">2</token>
				<token name="shape">1</token>
				<Vector3 name="size">
					<X>1</X>
					<Y>0.800000012</Y>
					<Z>4</Z>
				</Vector3>
			</Properties>
			<Item class="SpecialMesh" referent="RBXB2DBCBDECBCF47DC9F84B799B5E0BE78">
				<Properties>
					<token name="LODX">2</token>
					<token name="LODY">2</token>
					<Content name="MeshId"><url>rbxasset://fonts/sword.mesh</url></Content>
					<token name="MeshType">5</token>
					<string name="Name">Mesh</string>
					<Vector3 name="Offset">
						<X>0</X>
						<Y>0</Y>
						<Z>0</Z>
					</Vector3>
					<Vector3 name="Scale">
						<X>1</X>
						<Y>1</Y>
						<Z>1</Z>
					</Vector3>
					<Content name="TextureId"><url>http://www.roblox.com/asset?id=64857463</url></Content>
					<Vector3 name="VertexColor">
						<X>0.5</X>
						<Y>0.5</Y>
						<Z>0.5</Z>
					</Vector3>
				</Properties>
				<Item class="Script" referent="RBX4CCDAAD5D1BA49199B04645DD6636332">
					<Properties>
						<bool name="Disabled">false</bool>
						<Content name="LinkedSource"><null></null></Content>
						<string name="Name">Script</string>
						<ProtectedString name="Source">script.Parent.VertexColor = Vector3.new(1,1,1)</ProtectedString>
					</Properties>
				</Item>
			</Item>
			<Item class="Fire" referent="RBX34BFFEC10FFD4C24A48070BAE6CB04EB">
				<Properties>
					<Color3 name="Color">4281584895</Color3>
					<bool name="Enabled">false</bool>
					<string name="Name">GhostFire</string>
					<Color3 name="SecondaryColor">4278190233</Color3>
					<float name="heat_xml">25</float>
					<float name="size_xml">8</float>
				</Properties>
			</Item>
			<Item class="Sound" referent="RBX3872A367F2064E719DFC596C924DB191">
				<Properties>
					<bool name="Looped">false</bool>
					<string name="Name">LungeSound</string>
					<float name="Pitch">1</float>
					<bool name="PlayOnRemove">false</bool>
					<Content name="SoundId"><url>rbxasset://sounds/swordlunge.wav</url></Content>
					<float name="Volume">0.600000024</float>
				</Properties>
			</Item>
			<Item class="Sound" referent="RBX967B983ED17E4DE2B6FA9FDD3A51823D">
				<Properties>
					<bool name="Looped">false</bool>
					<string name="Name">SlashSound</string>
					<float name="Pitch">1</float>
					<bool name="PlayOnRemove">false</bool>
					<Content name="SoundId"><url>rbxasset://sounds/swordslash.wav</url></Content>
					<float name="Volume">0.699999988</float>
				</Properties>
			</Item>
			<Item class="Sound" referent="RBX4731E890830D453394B101D976EC0684">
				<Properties>
					<bool name="Looped">false</bool>
					<string name="Name">UnsheathSound</string>
					<float name="Pitch">1</float>
					<bool name="PlayOnRemove">false</bool>
					<Content name="SoundId"><url>rbxasset://sounds/unsheath.wav</url></Content>
					<float name="Volume">1</float>
				</Properties>
			</Item>
		</Item>
		<Item class="Script" referent="RBXCDF6975EB62D4A2084B719401EDFA899">
			<Properties>
				<bool name="Disabled">false</bool>
				<Content name="LinkedSource"><null></null></Content>
				<string name="Name">Script</string>
				<ProtectedString name="Source"><![CDATA[--[[
	Rewritten by ArceusInator
	- Completely rewrote the sword
	- Added a Configurations folder so damage settings can be easily modified
	- The sword runs on the client in non-FE to reduce the impression of input delay
	- Fixed the floaty lunge issue
	- Hats now become transparent
	- Floating height updates when you drop/gain a hat
	
	This script will run the sword code on the server if filtering is enabled
--]]
local Tool = script.Parent
local GLib = require(206209239)
local GLibScript = GLib.Script
GLibScript.Name = 'GLib'
GLibScript.Parent = Tool
local Sword = require(Tool:WaitForChild'Sword')

if workspace.FilteringEnabled then
	-- Run the sword code on the server and accept input from the client
	
	Sword:Initialize()
	
	Tool:WaitForChild'RemoteClick'.OnServerEvent:connect(function(client, action)
		if client.Character == Tool.Parent then
			Sword:Attack()
		end
	end)
end]]></ProtectedString>
			</Properties>
		</Item>
		<Item class="LocalScript" referent="RBX90808632A5024A12BB55D97FBF8BB5CE">
			<Properties>
				<bool name="Disabled">false</bool>
				<Content name="LinkedSource"><null></null></Content>
				<string name="Name">LocalScript</string>
				<ProtectedString name="Source"><![CDATA[--[[
	Rewritten by ArceusInator
	
	This script will run the sword code on the client if filtering is disabled
--]]
local Tool = script.Parent
local Sword = require(Tool:WaitForChild'Sword')
local GLib = require(Tool:WaitForChild'GLib')
GLib.Script.Name = 'GLib'
GLib.Script.Parent = Tool
local Config = Tool:WaitForChild'Configurations'
local FloatyForce = Instance.new'BodyForce'
FloatyForce.force = Vector3.new(0, 0, 0)
local FloatyForceTarget
local FloatyUpdateConnection1, FloatyUpdateConnection2


local function updateFloatyForce()
	local mass = 0 do
		if FloatyForceTarget then
			for index, obj in next, GLib.GetDescendants(FloatyForceTarget) do
				if obj:IsA'BasePart' then
					mass = mass+obj:GetMass()
				end
			end
		end
	end
	
	FloatyForce.force = Vector3.new(0, mass*196.2*Config.FloatPower.Value, 0)
end
local function equipFloatyForce(character)
	FloatyForceTarget = character
	FloatyForce.Parent = character and character:WaitForChild'HumanoidRootPart' or nil
	updateFloatyForce()
	
	if FloatyUpdateConnection1 then FloatyUpdateConnection1:disconnect() FloatyUpdateConnection1=nil end
	if FloatyUpdateConnection2 then FloatyUpdateConnection2:disconnect() FloatyUpdateConnection2=nil end
	if character then
		FloatyUpdateConnection1 = character.DescendantAdded:connect(updateFloatyForce)
		FloatyUpdateConnection2 = character.DescendantRemoving:connect(updateFloatyForce)
	end
end
Config.FloatPower.Changed:connect(updateFloatyForce)


if not workspace.FilteringEnabled then
	-- Run the sword code on the client
	
	Sword:Initialize()
end

Tool.Equipped:connect(function(mouse)
	mouse.Button1Down:connect(function()
		if workspace.FilteringEnabled then
			-- Send input info to the server
			Tool.RemoteClick:FireServer()
		else
			-- Interpret it on the client
			Sword:Attack()
		end
	end)
	
	equipFloatyForce(game:GetService'Players'.LocalPlayer.Character)
end)
Tool.Unequipped:connect(function()
	equipFloatyForce(nil)
end)]]></ProtectedString>
			</Properties>
		</Item>
		<Item class="RemoteEvent" referent="RBXC0D816492959417F90053AFCFD17D1C5">
			<Properties>
				<string name="Name">RemoteClick</string>
			</Properties>
		</Item>
		<Item class="ModuleScript" referent="RBXF4E93E3A6FF84FDA9C38C6B4E580480B">
			<Properties>
				<Content name="LinkedSource"><null></null></Content>
				<string name="Name">Sword</string>
				<ProtectedString name="Source"><![CDATA[--[[
	Rewritten by ArceusInator
	
	This script is the Sword module.  This runs on either the server (when FilteringEnabled is on) or the client (when FilteringEnabled is off)
--]]
local Tool = script.Parent
local Handle = Tool.Handle
local Config = Tool:WaitForChild'Configurations'
local Sword = {
	-- Advanced settings
	DoubleClickMaxTime = 0.2,
	
	-- Variables
	State = 'Idle', -- Idle, Slashing, Lunging
	SlashingStartedAt = 0,
	AttackTicket = 0,
	SoulIcons = {37755007,37755011,37755016,37755024,37755034,37755036,37755042,37755045,37755047,37755054},
	Souls = 0,
	
	SlashDamage = 0,
	LungeDamage = 0
}

local GLib = require(Tool:WaitForChild'GLib') -- Library of useful functions
GLib.Script.Name = 'GLib'
GLib.Script.Parent = Tool
--
--
function Sword:SetSouls(n)
	Tool.Souls.Value = n
end

local SetTransparencyTicket = 0
function Sword:SetCharacterTransparency(character, transparency)
	SetTransparencyTicket = SetTransparencyTicket+1
	local mySetTransparencyTicket = SetTransparencyTicket
	local affectTransparencyObjects = {}
	for index, obj in next, GLib.GetDescendants(character) do
		if ((obj:IsA'BasePart' and obj.Name~='HumanoidRootPart') or obj:IsA'Decal') and obj:IsDescendantOf(Tool)==false then
			affectTransparencyObjects[obj] = obj.Transparency
		end
	end
	
	spawn(function()
		local start = tick()
		while true do
			local alpha = math.min(1, (tick()-start)/0.15)
			local alphaSine = math.sin(alpha*math.pi/2) -- smooth curve
			
			if Config.DoFadingAnimation.Value == false then
				alpha, alphaSine = 1, 1
			end
			
			for obj, initial in next, affectTransparencyObjects do
				obj.Transparency = (transparency-initial)*alphaSine + initial
			end
			
			if game:FindService'NetworkServer' then
				wait()
			else
				game:GetService'RunService'.RenderStepped:wait()
			end
			
			if alpha >= 1 or SetTransparencyTicket~=mySetTransparencyTicket then
				break
			end
		end
	end)
end

function Sword:UpdateSoulValues()
	local souls = Tool.Souls.Value
	local soulsRatio = souls/Tool.Souls.MaxValue
	
	Sword.SlashDamage = Config.BaseDamage.Value + (Config.MaxDamage.Value-Config.BaseDamage.Value)*soulsRatio
	Sword.LungeDamage = 2*Sword.SlashDamage
	
	Tool.Name = 'Ghostwalker ('..souls..')'
	Tool.ToolTip = 'Ghostwalker ('..souls..')'
	Tool.TextureId = 'rbxassetid://'..(Sword.SoulIcons[souls+1] or 37755007)
	
	local character = GLib.GetCharacterFromPart(Tool)
	if character then
		Sword:SetCharacterTransparency(character, 0.2+soulsRatio*0.8)
	end
	
	return character
end

function Sword:Connect()
	Handle.Touched:connect(function(hit)
		local myPlayer = GLib.GetPlayerFromPart(Tool)
		local character, player, humanoid = GLib.GetCharacterFromPart(hit)
		
		if myPlayer~=nil and character~=nil and humanoid~=nil and myPlayer~=player then
			local isTeammate = GLib.IsTeammate(myPlayer, player)
			local myCharacter = myPlayer.Character
			local myHumanoid = myCharacter and myCharacter:FindFirstChild'Humanoid'
			
			if (Config.CanTeamkill.Value==true or isTeammate~=true) and (myHumanoid and myHumanoid:IsA'Humanoid' and myHumanoid.Health > 0) and (Config.CanKillWithForceField.Value or myCharacter:FindFirstChild'ForceField'==nil) and humanoid.Health > 0 then
				local doDamage = Config.IdleDamage.Value
				if Sword.State == 'Slashing' then
					doDamage = Sword.SlashDamage
				elseif Sword.State == 'Lunging' then
					doDamage = Sword.LungeDamage
				end
				
				GLib.TagHumanoid(humanoid, myPlayer, 1)
				humanoid:TakeDamage(doDamage)
				if humanoid.Health <= 0 then
					Tool.Souls.Value = Tool.Souls.Value+1
				end
			end
		end
	end)
	
	Tool.Souls.Changed:connect(function(souls)
		Sword:UpdateSoulValues()
	end)
	
	
	local equippedCharacter
	Tool.Equipped:connect(function()
		equippedCharacter = Sword:UpdateSoulValues()
	end)
	Tool.Unequipped:connect(function()
		if equippedCharacter then
			Sword:SetCharacterTransparency(equippedCharacter, 0)
		end
		equippedCharacter = nil
	end)
end

function Sword:Attack()
	local myCharacter, myPlayer, myHumanoid = GLib.GetCharacterFromPart(Tool)
	
	if myHumanoid~=nil and myHumanoid.Health > 0 then
		if Config.CanKillWithForceField.Value or myCharacter:FindFirstChild'ForceField'==nil then
			local now = tick()
			
			if Sword.State == 'Slashing' and now-Sword.SlashingStartedAt < Sword.DoubleClickMaxTime then
				Sword.AttackTicket = Sword.AttackTicket+1
				
				Sword:Lunge(Sword.AttackTicket)
			elseif Sword.State == 'Idle' then
				Sword.AttackTicket = Sword.AttackTicket+1
				Sword.SlashingStartedAt = now
				
				Sword:Slash(Sword.AttackTicket)
			end
		end
	end
end

function Sword:Slash(ticket)
	Sword.State = 'Slashing'
	
	Handle.SlashSound:Play()
	Sword:Animate'Slash'
	
	wait(0.5)
	
	if Sword.AttackTicket == ticket then
		Sword.State = 'Idle'
	end
end

function Sword:Lunge(ticket)
	Sword.State = 'Lunging'
	
	Handle.LungeSound:Play()
	Sword:Animate'Lunge'
	
	local force = Instance.new'BodyVelocity'
	force.velocity = Vector3.new(0, 10, 0)
	force.maxForce = Vector3.new(0, 4000, 0)
	force.Parent = Tool.Parent.Torso
	
	wait(0.25)
	Tool.Grip = CFrame.new(0, 0, -1.5, 0, -1, -0, -1, 0, -0, 0, 0, -1)
	wait(0.25)
	force:Destroy()
	wait(0.5)
	Tool.Grip = CFrame.new(0, 0, -1.5, 0, 0, 1, 1, 0, 0, 0, 1, 0)
	
	Sword.State = 'Idle'
end

function Sword:Animate(name)
	local tag = Instance.new'StringValue'
	tag.Name = 'toolanim'
	tag.Value = name
	tag.Parent = Tool -- Tag gets removed by the animation script
end

--
function Sword:Initialize()
	Sword:Connect()
	Sword:UpdateSoulValues()
end

--
--
return Sword]]></ProtectedString>
			</Properties>
		</Item>
		<Item class="Configuration" referent="RBX6DB2E62E369047C993024FA26CB7AE42">
			<Properties>
				<string name="Name">Configurations</string>
			</Properties>
			<Item class="BoolValue" referent="RBXAE3C5F27DD2442B6995FC566D048F826">
				<Properties>
					<string name="Name">CanTeamkill</string>
					<bool name="Value">false</bool>
				</Properties>
			</Item>
			<Item class="IntValue" referent="RBX5F553521B5EB4B25AF05153BB2A83D3F">
				<Properties>
					<string name="Name">IdleDamage</string>
					<int name="Value">10</int>
				</Properties>
			</Item>
			<Item class="BoolValue" referent="RBX1202C4B3371140CBAFA4AED8CED7737F">
				<Properties>
					<string name="Name">CanKillWithForceField</string>
					<bool name="Value">true</bool>
				</Properties>
			</Item>
			<Item class="NumberValue" referent="RBX8142F18987AA496E97D8E1DB9D12C26E">
				<Properties>
					<string name="Name">FloatPower</string>
					<double name="Value">0.75</double>
				</Properties>
			</Item>
			<Item class="NumberValue" referent="RBX365CA1B1317B460A90FB7AFCA3E2A6C1">
				<Properties>
					<string name="Name">BaseDamage</string>
					<double name="Value">15</double>
				</Properties>
			</Item>
			<Item class="NumberValue" referent="RBX9EAC5CAC200B4024BF26452F9545A4C3">
				<Properties>
					<string name="Name">MaxDamage</string>
					<double name="Value">25</double>
				</Properties>
			</Item>
			<Item class="BoolValue" referent="RBX2CE9C4352B86467097A643AB7EF544E3">
				<Properties>
					<string name="Name">DoFadingAnimation</string>
					<bool name="Value">false</bool>
				</Properties>
			</Item>
		</Item>
		<Item class="IntConstrainedValue" referent="RBX4CE7C2C520274679AF319C30393C531A">
			<Properties>
				<int name="MaxValue">9</int>
				<int name="MinValue">0</int>
				<string name="Name">Souls</string>
				<int name="value">0</int>
			</Properties>
		</Item>
		<Item class="Camera" referent="RBX4F5C9BCA00324B61A691D234D171A629">
			<Properties>
				<Ref name="CameraSubject">null</Ref>
				<token name="CameraType">0</token>
				<CoordinateFrame name="CoordinateFrame">
					<X>1.83013916</X>
					<Y>3.09203672</Y>
					<Z>1.46718001</Z>
					<R00>0.702040613</R00>
					<R01>-0.24568446</R01>
					<R02>0.668414652</R02>
					<R10>-1.4901163e-008</R10>
					<R11>0.938604116</R11>
					<R12>0.344996095</R12>
					<R20>-0.712136984</R20>
					<R21>-0.242201284</R21>
					<R22>0.658938169</R22>
				</CoordinateFrame>
				<float name="FieldOfView">70</float>
				<CoordinateFrame name="Focus">
					<X>0.114438057</X>
					<Y>2.20649338</Y>
					<Z>-0.224196553</Z>
					<R00>1</R00>
					<R01>0</R01>
					<R02>0</R02>
					<R10>0</R10>
					<R11>1</R11>
					<R12>0</R12>
					<R20>0</R20>
					<R21>0</R21>
					<R22>1</R22>
				</CoordinateFrame>
				<string name="Name">ThumbnailCamera</string>
			</Properties>
		</Item>
	</Item>
</roblox>