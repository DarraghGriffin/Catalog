<roblox xmlns:xmime="http://www.w3.org/2005/05/xmlmime" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://www.roblox.com/roblox.xsd" version="4">
	<External>null</External>
	<External>nil</External>
	<Item class="Tool" referent="RBX1902E29452224D458C412C5B0D85C245">
		<Properties>
			<bool name="CanBeDropped">true</bool>
			<bool name="Enabled">true</bool>
			<CoordinateFrame name="Grip">
				<X>0</X>
				<Y>0</Y>
				<Z>-2</Z>
				<R00>0</R00>
				<R01>0</R01>
				<R02>1</R02>
				<R10>1</R10>
				<R11>0</R11>
				<R12>0</R12>
				<R20>0</R20>
				<R21>1</R21>
				<R22>0</R22>
			</CoordinateFrame>
			<bool name="ManualActivationOnly">false</bool>
			<string name="Name">Venomshank</string>
			<Content name="TextureId"><url>http://www.roblox.com/asset/?id=82741319</url></Content>
			<string name="ToolTip">Venomshank</string>
		</Properties>
		<Item class="Part" referent="RBX65EFD5777A2B4C6F95DE80912FC66FF2">
			<Properties>
				<bool name="Anchored">false</bool>
				<float name="BackParamA">-0.5</float>
				<float name="BackParamB">0.5</float>
				<token name="BackSurface">0</token>
				<token name="BackSurfaceInput">0</token>
				<float name="BottomParamA">-0.5</float>
				<float name="BottomParamB">0.5</float>
				<token name="BottomSurface">0</token>
				<token name="BottomSurfaceInput">0</token>
				<int name="BrickColor">199</int>
				<CoordinateFrame name="CFrame">
					<X>0.170000002</X>
					<Y>2.1500001</Y>
					<Z>0.0899999961</Z>
					<R00>0.00096754462</R00>
					<R01>-0.923925817</R01>
					<R02>0.382570565</R02>
					<R10>0.761063218</R10>
					<R11>0.248845309</R11>
					<R12>0.599048257</R12>
					<R20>-0.648676991</R20>
					<R21>0.290580779</R21>
					<R22>0.703406692</R22>
				</CoordinateFrame>
				<bool name="CanCollide">true</bool>
				<float name="Elasticity">0.5</float>
				<float name="Friction">0.300000012</float>
				<float name="FrontParamA">-0.5</float>
				<float name="FrontParamB">0.5</float>
				<token name="FrontSurface">0</token>
				<token name="FrontSurfaceInput">0</token>
				<float name="LeftParamA">-0.5</float>
				<float name="LeftParamB">0.5</float>
				<token name="LeftSurface">0</token>
				<token name="LeftSurfaceInput">0</token>
				<bool name="Locked">false</bool>
				<token name="Material">1088</token>
				<string name="Name">Handle</string>
				<float name="Reflectance">0.699999988</float>
				<float name="RightParamA">-0.5</float>
				<float name="RightParamB">0.5</float>
				<token name="RightSurface">0</token>
				<token name="RightSurfaceInput">0</token>
				<Vector3 name="RotVelocity">
					<X>0</X>
					<Y>0</Y>
					<Z>0</Z>
				</Vector3>
				<float name="TopParamA">-0.5</float>
				<float name="TopParamB">0.5</float>
				<token name="TopSurface">0</token>
				<token name="TopSurfaceInput">0</token>
				<float name="Transparency">0</float>
				<Vector3 name="Velocity">
					<X>0</X>
					<Y>0</Y>
					<Z>0</Z>
				</Vector3>
				<token name="formFactorRaw">2</token>
				<token name="shape">1</token>
				<Vector3 name="size">
					<X>1</X>
					<Y>0.800000012</Y>
					<Z>6</Z>
				</Vector3>
			</Properties>
			<Item class="SpecialMesh" referent="RBXB3DF73D47FD740BFBB4EAA0DC7E7A8CF">
				<Properties>
					<token name="LODX">2</token>
					<token name="LODY">2</token>
					<Content name="MeshId"><url>rbxasset://fonts/sword.mesh</url></Content>
					<token name="MeshType">5</token>
					<string name="Name">Mesh</string>
					<Vector3 name="Offset">
						<X>0</X>
						<Y>0</Y>
						<Z>0</Z>
					</Vector3>
					<Vector3 name="Scale">
						<X>1.5</X>
						<Y>1.5</Y>
						<Z>1.5</Z>
					</Vector3>
					<Content name="TextureId"><url>rbxasset://textures/SwordTexture.png</url></Content>
					<Vector3 name="VertexColor">
						<X>0.300000012</X>
						<Y>1</Y>
						<Z>0.300000012</Z>
					</Vector3>
				</Properties>
			</Item>
			<Item class="Sound" referent="RBX2D53220040AF4DCE9CC47364A754B136">
				<Properties>
					<bool name="Looped">false</bool>
					<string name="Name">LungeSound</string>
					<float name="Pitch">1</float>
					<bool name="PlayOnRemove">false</bool>
					<Content name="SoundId"><url>rbxasset://sounds/swordlunge.wav</url></Content>
					<float name="Volume">0.600000024</float>
				</Properties>
			</Item>
			<Item class="Sound" referent="RBXF32982F159E64F678BD560B504BC7CA8">
				<Properties>
					<bool name="Looped">false</bool>
					<string name="Name">SlashSound</string>
					<float name="Pitch">1</float>
					<bool name="PlayOnRemove">false</bool>
					<Content name="SoundId"><url>rbxasset://sounds/swordslash.wav</url></Content>
					<float name="Volume">0.699999988</float>
				</Properties>
			</Item>
			<Item class="Sound" referent="RBXF151EB2469AB4144BEAFADAA741C92A5">
				<Properties>
					<bool name="Looped">false</bool>
					<string name="Name">UnsheathSound</string>
					<float name="Pitch">1</float>
					<bool name="PlayOnRemove">false</bool>
					<Content name="SoundId"><url>rbxasset://sounds/unsheath.wav</url></Content>
					<float name="Volume">1</float>
				</Properties>
			</Item>
		</Item>
		<Item class="Script" referent="RBX07F5186A854C42029080B413E3672ADF">
			<Properties>
				<bool name="Disabled">false</bool>
				<Content name="LinkedSource"><null></null></Content>
				<string name="Name">Script</string>
				<ProtectedString name="Source"><![CDATA[--[[
	Rewritten by ArceusInator
	- Completely rewrote the sword
	- Added a Configurations folder so damage settings can be easily modified
	- The sword runs on the client in non-FE to reduce the impression of input delay
	- Fixed the floaty lunge issue
	
	This script will run the sword code on the server if filtering is enabled
--]]
local Tool = script.Parent
local GLib = require(206209239)
local GLibScript = GLib.Script
GLibScript.Name = 'GLib'
GLibScript.Parent = Tool
local Sword = require(Tool:WaitForChild'Sword')

if workspace.FilteringEnabled then
	-- Run the sword code on the server and accept input from the client
	
	Sword:Initialize()
	
	Tool:WaitForChild'RemoteClick'.OnServerEvent:connect(function(client, action)
		if client.Character == Tool.Parent then
			Sword:Attack()
		end
	end)
end]]></ProtectedString>
			</Properties>
		</Item>
		<Item class="LocalScript" referent="RBX8BA36D46CADD4F3DBBC0C3C908634777">
			<Properties>
				<bool name="Disabled">false</bool>
				<Content name="LinkedSource"><null></null></Content>
				<string name="Name">LocalScript</string>
				<ProtectedString name="Source"><![CDATA[--[[
	Rewritten by ArceusInator
	
	This script will run the sword code on the client if filtering is disabled
--]]
local Tool = script.Parent
local Sword = require(Tool:WaitForChild'Sword')

if not workspace.FilteringEnabled then
	-- Run the sword code on the client
	
	Sword:Initialize()
end

Tool.Equipped:connect(function(mouse)
	mouse.Button1Down:connect(function()
		if workspace.FilteringEnabled then
			-- Send input info to the server
			Tool.RemoteClick:FireServer()
		else
			-- Interpret it on the client
			Sword:Attack()
		end
	end)
end)]]></ProtectedString>
			</Properties>
		</Item>
		<Item class="RemoteEvent" referent="RBXF37646F660CD4A74AD94B779A804C63C">
			<Properties>
				<string name="Name">RemoteClick</string>
			</Properties>
		</Item>
		<Item class="ModuleScript" referent="RBX2B6712338FB54FB99425C911AC351509">
			<Properties>
				<Content name="LinkedSource"><null></null></Content>
				<string name="Name">Sword</string>
				<ProtectedString name="Source"><![CDATA[--[[
	Rewritten by ArceusInator
	
	This script is the Sword module.  This runs on either the server (when FilteringEnabled is on) or the client (when FilteringEnabled is off)
--]]
local Tool = script.Parent
local Handle = Tool.Handle
local Config = Tool:WaitForChild'Configurations'
local Sword = {
	-- Advanced settings
	DoubleClickMaxTime = 0.2,
	
	-- Variables
	State = 'Idle', -- Idle, Slashing, Lunging
	SlashingStartedAt = 0,
	AttackTicket = 0,
	PoisonedCharacters = {}
}

local GLib = require(Tool:WaitForChild'GLib') -- Library of useful functions

--
--
function Sword:PoisonStep()
	local myPlayer = GLib.GetPlayerFromPart(Tool)
	
	for humanoid, info in next, Sword.PoisonedCharacters do
		if Sword:GetHumanoidIsPoisoned(humanoid) and info.Humanoid.Health > 0 then
			local damage = info.Humanoid.MaxHealth*Config.PoisonDamageRatio.Value
			GLib.TagHumanoid(humanoid, myPlayer, 0.1)
			if Config.PoisonBlockedByForceField.Value then
				info.Humanoid:TakeDamage(damage)
			else
				info.Humanoid.Health = info.Humanoid.Health-damage
			end
			
			spawn(function()
				for obj, propInfo in next, info.ChangeColorObjects do
					info.ChangeColorObjects[obj].Original = obj[propInfo.Property]
					if propInfo.Type == 'BrickColor' then
						obj[propInfo.Property] = Config.PoisonColor.Value
					elseif propInfo.Type == 'Color3' then
						obj[propInfo.Property] = Config.PoisonColor.Value.Color
					elseif propInfo.Type == 'Vector3' then
						obj[propInfo.Property] = Vector3.new(Config.PoisonColor.Value.r, Config.PoisonColor.Value.g, Config.PoisonColor.Value.b)
					end
				end
				wait(Config.PoisonRate.Value/2)
				for obj, propInfo in next, info.ChangeColorObjects do
					obj[propInfo.Property] = propInfo.Original
				end
			end)
			
			if tick() - info.StartedAt >= Config.PoisonDuration.Value then
				Sword:CureHumanoid(humanoid)
			end
		else
			Sword:CureHumanoid(humanoid)
		end
	end
end

function Sword:GetHumanoidIsPoisoned(humanoid)
	return humanoid:FindFirstChild'Venomshank_Poison'~=nil
end

function Sword:PoisonHumanoid(humanoid)
	if not Sword:GetHumanoidIsPoisoned(humanoid) and not GLib.IsProtected(humanoid) then
		local info = {
			Character = humanoid.Parent,
			Humanoid = humanoid,
			ChangeColorObjects = {},
			StartedAt = tick()
		}
		
		for index, obj in next, GLib.GetDescendants(info.Character) do
			if obj:IsA'BasePart' then
				info.ChangeColorObjects[obj] = {
					Property = 'BrickColor',
					Type = 'BrickColor',
					Original = obj.BrickColor
				}
			elseif obj:IsA'FileMesh' then
				info.ChangeColorObjects[obj] = {
					Property = 'VertexColor',
					Type = 'Vector3',
					Original = obj.VertexColor
				}
			elseif obj:IsA'Fire'or obj:IsA'Smoke' or obj:IsA'Light' then
				info.ChangeColorObjects[obj] = {
					Property = 'Color',
					Type = 'Color3',
					Original = obj.Color
				}
			elseif obj:IsA'Sparkles' then
				info.ChangeColorObjects[obj] = {
					Property = 'SparkleColor',
					Type = 'Colors',
					Original = obj.SparkleColor
				}
			end
		end
		
		Sword.PoisonedCharacters[humanoid] = info
		local status = Instance.new'Model' do
			status.Name = 'Venomshank_Poison'
			status.Parent = humanoid
		end
	end
end

function Sword:CureHumanoid(humanoid)
	Sword.PoisonedCharacters[humanoid] = nil
	
	if Sword:GetHumanoidIsPoisoned(humanoid) then
		humanoid.Venomshank_Poison:Destroy()
	end
end

function Sword:Connect()
	Handle.Touched:connect(function(hit)
		local myPlayer = GLib.GetPlayerFromPart(Tool)
		local character, player, humanoid = GLib.GetCharacterFromPart(hit)
		
		if myPlayer~=nil and character~=nil and humanoid~=nil and myPlayer~=player then
			local isTeammate = GLib.IsTeammate(myPlayer, player)
			local myCharacter = myPlayer.Character
			local myHumanoid = myCharacter and myCharacter:FindFirstChild'Humanoid'
			
			if (Config.CanTeamkill.Value==true or isTeammate~=true) and (myHumanoid and myHumanoid:IsA'Humanoid' and myHumanoid.Health > 0) and (Config.CanKillWithForceField.Value or myCharacter:FindFirstChild'ForceField'==nil) then
				local doDamage = Config.IdleDamage.Value
				if Sword.State == 'Slashing' then
					doDamage = Config.SlashDamage.Value
				elseif Sword.State == 'Lunging' then
					doDamage = Config.LungeDamage.Value
				end
				
				GLib.TagHumanoid(humanoid, myPlayer, 1)
				humanoid:TakeDamage(doDamage)
				Sword:PoisonHumanoid(humanoid)
			end
		end
	end)
end

function Sword:Attack()
	local myCharacter, myPlayer, myHumanoid = GLib.GetCharacterFromPart(Tool)
	
	if myHumanoid~=nil and myHumanoid.Health > 0 then
		if Config.CanKillWithForceField.Value or myCharacter:FindFirstChild'ForceField'==nil then
			local now = tick()
			
			if Sword.State == 'Slashing' and now-Sword.SlashingStartedAt < Sword.DoubleClickMaxTime then
				Sword.AttackTicket = Sword.AttackTicket+1
				
				Sword:Lunge(Sword.AttackTicket)
			elseif Sword.State == 'Idle' then
				Sword.AttackTicket = Sword.AttackTicket+1
				Sword.SlashingStartedAt = now
				
				Sword:Slash(Sword.AttackTicket)
			end
		end
	end
end

function Sword:Slash(ticket)
	Sword.State = 'Slashing'
	
	Handle.SlashSound:Play()
	Sword:Animate'Slash'
	
	wait(0.5)
	
	if Sword.AttackTicket == ticket then
		Sword.State = 'Idle'
	end
end

function Sword:Lunge(ticket)
	Sword.State = 'Lunging'
	
	Handle.LungeSound:Play()
	Sword:Animate'Lunge'
	
	local force = Instance.new'BodyVelocity'
	force.velocity = Vector3.new(0, 10, 0)
	force.maxForce = Vector3.new(0, 4000, 0)
	force.Parent = Tool.Parent.Torso
	
	wait(0.25)
	Tool.GripForward = Vector3.new(0,0,1)
	Tool.GripRight = Vector3.new(0,-1,0)
	Tool.GripUp = Vector3.new(-1,0,0)
	wait(0.25)
	force:Destroy()
	wait(0.5)
	Tool.GripForward = Vector3.new(-1,0,0)
	Tool.GripRight = Vector3.new(0,1,0)
	Tool.GripUp = Vector3.new(0,0,1)
	
	Sword.State = 'Idle'
end

function Sword:Animate(name)
	local tag = Instance.new'StringValue'
	tag.Name = 'toolanim'
	tag.Value = name
	tag.Parent = Tool -- Tag gets removed by the animation script
end

--
function Sword:Initialize()
	Sword:Connect()
	
	spawn(function()
		while script:IsDescendantOf(game) do
			Sword:PoisonStep()
			wait(Config.PoisonRate.Value)
		end
	end)
end

--
--
return Sword]]></ProtectedString>
			</Properties>
		</Item>
		<Item class="Configuration" referent="RBX544369409D9D427D8A2A5F554973DBE4">
			<Properties>
				<string name="Name">Configurations</string>
			</Properties>
			<Item class="BoolValue" referent="RBXED42EDF30D0C467F8B7A891734A38125">
				<Properties>
					<string name="Name">CanTeamkill</string>
					<bool name="Value">false</bool>
				</Properties>
			</Item>
			<Item class="IntValue" referent="RBX216E8515005D440BB2C61EE3D17EC567">
				<Properties>
					<string name="Name">IdleDamage</string>
					<int name="Value">5</int>
				</Properties>
			</Item>
			<Item class="IntValue" referent="RBX2C8CFC550A2D4A39A8CE7A05B0BA564A">
				<Properties>
					<string name="Name">SlashDamage</string>
					<int name="Value">10</int>
				</Properties>
			</Item>
			<Item class="IntValue" referent="RBX6D49B2A80A354B9989D9FFDA4C8E240D">
				<Properties>
					<string name="Name">LungeDamage</string>
					<int name="Value">30</int>
				</Properties>
			</Item>
			<Item class="BoolValue" referent="RBX8AB32F70CC8C4D83871F124A5551E48C">
				<Properties>
					<string name="Name">CanKillWithForceField</string>
					<bool name="Value">true</bool>
				</Properties>
			</Item>
			<Item class="NumberValue" referent="RBX797D3D406B6E40CF963BE7D4BAE706DE">
				<Properties>
					<string name="Name">PoisonRate</string>
					<double name="Value">2</double>
				</Properties>
			</Item>
			<Item class="NumberValue" referent="RBX9FC9CF28DE704C7FB989732BBAD25132">
				<Properties>
					<string name="Name">PoisonDamageRatio</string>
					<double name="Value">0.125</double>
				</Properties>
			</Item>
			<Item class="BoolValue" referent="RBX8D4610C1C12C4DE2897D1D0AD32E139B">
				<Properties>
					<string name="Name">PoisonBlockedByForceField</string>
					<bool name="Value">false</bool>
				</Properties>
			</Item>
			<Item class="NumberValue" referent="RBXF1AB0BA899374B0F95D68742643984FD">
				<Properties>
					<string name="Name">PoisonDuration</string>
					<double name="Value">10</double>
				</Properties>
			</Item>
			<Item class="BrickColorValue" referent="RBX0724C54E47DD49B291C0077F975FFD55">
				<Properties>
					<string name="Name">PoisonColor</string>
					<int name="Value">119</int>
				</Properties>
			</Item>
		</Item>
		<Item class="Camera" referent="RBX9D449FB4E8A34454B1CAF1C7C7402C38">
			<Properties>
				<Ref name="CameraSubject">null</Ref>
				<token name="CameraType">0</token>
				<CoordinateFrame name="CoordinateFrame">
					<X>-26.0837555</X>
					<Y>3.03664804</Y>
					<Z>-2.21162081</Z>
					<R00>-0.0876019299</R00>
					<R01>0.0345184132</R01>
					<R02>-0.995557368</R02>
					<R10>-0</R10>
					<R11>0.999399543</R11>
					<R12>0.0346516296</R12>
					<R20>0.99615556</R20>
					<R21>0.00303554954</R21>
					<R22>-0.0875493214</R22>
				</CoordinateFrame>
				<float name="FieldOfView">10</float>
				<CoordinateFrame name="Focus">
					<X>-0.0184822083</X>
					<Y>2.12941337</Y>
					<Z>0.0805594921</Z>
					<R00>1</R00>
					<R01>0</R01>
					<R02>0</R02>
					<R10>0</R10>
					<R11>1</R11>
					<R12>0</R12>
					<R20>0</R20>
					<R21>0</R21>
					<R22>1</R22>
				</CoordinateFrame>
				<string name="Name">ThumbnailCamera</string>
			</Properties>
		</Item>
	</Item>
</roblox>