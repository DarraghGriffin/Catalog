<roblox xmlns:xmime="http://www.w3.org/2005/05/xmlmime" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://www.roblox.com/roblox.xsd" version="4">
	<External>null</External>
	<External>nil</External>
	<Item class="Tool" referent="RBXBC48D6513B384115AC603C20B0C8CE8C">
		<Properties>
			<bool name="CanBeDropped">true</bool>
			<bool name="Enabled">true</bool>
			<CoordinateFrame name="Grip">
				<X>0</X>
				<Y>0</Y>
				<Z>-0.75</Z>
				<R00>0</R00>
				<R01>0</R01>
				<R02>1</R02>
				<R10>1</R10>
				<R11>0</R11>
				<R12>0</R12>
				<R20>0</R20>
				<R21>1</R21>
				<R22>0</R22>
			</CoordinateFrame>
			<bool name="ManualActivationOnly">false</bool>
			<string name="Name">Ice Dagger</string>
			<Content name="TextureId"><url>http://www.roblox.com/asset/?id=83689547 </url></Content>
			<string name="ToolTip">Icedagger</string>
		</Properties>
		<Item class="Part" referent="RBX3340817EA399435BB12807FD443B2C81">
			<Properties>
				<bool name="Anchored">false</bool>
				<float name="BackParamA">-0.5</float>
				<float name="BackParamB">0.5</float>
				<token name="BackSurface">0</token>
				<token name="BackSurfaceInput">0</token>
				<float name="BottomParamA">-0.5</float>
				<float name="BottomParamB">0.5</float>
				<token name="BottomSurface">0</token>
				<token name="BottomSurfaceInput">0</token>
				<int name="BrickColor">1</int>
				<CoordinateFrame name="CFrame">
					<X>0</X>
					<Y>2</Y>
					<Z>0</Z>
					<R00>0.00096754462</R00>
					<R01>-0.923925817</R01>
					<R02>0.382570565</R02>
					<R10>0.761063218</R10>
					<R11>0.248845309</R11>
					<R12>0.599048257</R12>
					<R20>-0.648676991</R20>
					<R21>0.290580779</R21>
					<R22>0.703406692</R22>
				</CoordinateFrame>
				<bool name="CanCollide">true</bool>
				<float name="Elasticity">0.5</float>
				<float name="Friction">0.300000012</float>
				<float name="FrontParamA">-0.5</float>
				<float name="FrontParamB">0.5</float>
				<token name="FrontSurface">0</token>
				<token name="FrontSurfaceInput">0</token>
				<float name="LeftParamA">-0.5</float>
				<float name="LeftParamB">0.5</float>
				<token name="LeftSurface">0</token>
				<token name="LeftSurfaceInput">0</token>
				<bool name="Locked">false</bool>
				<token name="Material">1536</token>
				<string name="Name">Handle</string>
				<float name="Reflectance">0</float>
				<float name="RightParamA">-0.5</float>
				<float name="RightParamB">0.5</float>
				<token name="RightSurface">0</token>
				<token name="RightSurfaceInput">0</token>
				<Vector3 name="RotVelocity">
					<X>0</X>
					<Y>0</Y>
					<Z>0</Z>
				</Vector3>
				<float name="TopParamA">-0.5</float>
				<float name="TopParamB">0.5</float>
				<token name="TopSurface">0</token>
				<token name="TopSurfaceInput">0</token>
				<float name="Transparency">0</float>
				<Vector3 name="Velocity">
					<X>0</X>
					<Y>0</Y>
					<Z>0</Z>
				</Vector3>
				<token name="formFactorRaw">2</token>
				<token name="shape">1</token>
				<Vector3 name="size">
					<X>1</X>
					<Y>0.800000012</Y>
					<Z>2</Z>
				</Vector3>
			</Properties>
			<Item class="SpecialMesh" referent="RBXD0B54939BC084C378B4DFF023849C981">
				<Properties>
					<token name="LODX">2</token>
					<token name="LODY">2</token>
					<Content name="MeshId"><url>rbxasset://fonts/sword.mesh</url></Content>
					<token name="MeshType">5</token>
					<string name="Name">Mesh</string>
					<Vector3 name="Offset">
						<X>0</X>
						<Y>0</Y>
						<Z>0</Z>
					</Vector3>
					<Vector3 name="Scale">
						<X>0.5</X>
						<Y>0.5</Y>
						<Z>0.5</Z>
					</Vector3>
					<Content name="TextureId"><url>http://www.roblox.com/asset?id=64857463</url></Content>
					<Vector3 name="VertexColor">
						<X>0</X>
						<Y>0.699999988</Y>
						<Z>1</Z>
					</Vector3>
				</Properties>
			</Item>
			<Item class="Sound" referent="RBX3094146A4D874A599234CF0606D193F3">
				<Properties>
					<bool name="Looped">false</bool>
					<string name="Name">LungeSound</string>
					<float name="Pitch">1</float>
					<bool name="PlayOnRemove">false</bool>
					<Content name="SoundId"><url>rbxasset://sounds/swordlunge.wav</url></Content>
					<float name="Volume">0.600000024</float>
				</Properties>
			</Item>
			<Item class="Sound" referent="RBX647194B0B65E4B04A0E81DFF17D25DA9">
				<Properties>
					<bool name="Looped">false</bool>
					<string name="Name">SlashSound</string>
					<float name="Pitch">1</float>
					<bool name="PlayOnRemove">false</bool>
					<Content name="SoundId"><url>rbxasset://sounds/swordslash.wav</url></Content>
					<float name="Volume">0.699999988</float>
				</Properties>
			</Item>
			<Item class="Sound" referent="RBXC1AA3D9DF7664EA5BC053C207C695471">
				<Properties>
					<bool name="Looped">false</bool>
					<string name="Name">UnsheathSound</string>
					<float name="Pitch">1</float>
					<bool name="PlayOnRemove">false</bool>
					<Content name="SoundId"><url>rbxasset://sounds/unsheath.wav</url></Content>
					<float name="Volume">1</float>
				</Properties>
			</Item>
		</Item>
		<Item class="Script" referent="RBXB86CEC19E302452CB3618A7DC26D9749">
			<Properties>
				<bool name="Disabled">false</bool>
				<Content name="LinkedSource"><null></null></Content>
				<string name="Name">Script</string>
				<ProtectedString name="Source"><![CDATA[--[[
	Rewritten by ArceusInator
	- Completely rewrote the sword
	- Added a Configurations folder so damage settings can be easily modified
	- The sword runs on the client in non-FE to reduce the impression of input delay
	- Fixed the floaty lunge issue
	
	This script will run the sword code on the server if filtering is enabled
--]]
local Tool = script.Parent
local GLib = require(206209239)
local GLibScript = GLib.Script
GLibScript.Name = 'GLib'
GLibScript.Parent = Tool
local Sword = require(Tool:WaitForChild'Sword')

if workspace.FilteringEnabled then
	-- Run the sword code on the server and accept input from the client
	
	Sword:Initialize()
	
	Tool:WaitForChild'RemoteClick'.OnServerEvent:connect(function(client, action)
		if client.Character == Tool.Parent then
			Sword:Attack()
		end
	end)
end]]></ProtectedString>
			</Properties>
		</Item>
		<Item class="LocalScript" referent="RBXD53796643CF543A181BA153F950C366B">
			<Properties>
				<bool name="Disabled">false</bool>
				<Content name="LinkedSource"><null></null></Content>
				<string name="Name">LocalScript</string>
				<ProtectedString name="Source"><![CDATA[--[[
	Rewritten by ArceusInator
	
	This script will run the sword code on the client if filtering is disabled
--]]
local Tool = script.Parent
local Sword = require(Tool:WaitForChild'Sword')

if not workspace.FilteringEnabled then
	-- Run the sword code on the client
	
	Sword:Initialize()
end

Tool.Equipped:connect(function(mouse)
	mouse.Button1Down:connect(function()
		if workspace.FilteringEnabled then
			-- Send input info to the server
			Tool.RemoteClick:FireServer()
		else
			-- Interpret it on the client
			Sword:Attack()
		end
	end)
end)]]></ProtectedString>
			</Properties>
		</Item>
		<Item class="RemoteEvent" referent="RBX4FF6944A6A124549848F5B3D1AAE69C5">
			<Properties>
				<string name="Name">RemoteClick</string>
			</Properties>
		</Item>
		<Item class="ModuleScript" referent="RBXE26EA1D179594A2498E81F9F161AF6F5">
			<Properties>
				<Content name="LinkedSource"><null></null></Content>
				<string name="Name">Sword</string>
				<ProtectedString name="Source"><![CDATA[--[[
	Rewritten by ArceusInator
	
	This script is the Sword module.  This runs on either the server (when FilteringEnabled is on) or the client (when FilteringEnabled is off)
--]]
local Tool = script.Parent
local Handle = Tool.Handle
local Config = Tool:WaitForChild'Configurations'
local Sword = {
	-- Advanced settings
	DoubleClickMaxTime = 0.2,
	
	-- Variables
	State = 'Idle', -- Idle, Slashing, Lunging
	SlashingStartedAt = 0,
	AttackTicket = 0,
	Active = false,
	EquippedTicket = 0
}

local GLib = require(Tool:WaitForChild'GLib') -- Library of useful functions

--
--
function Sword:Freeze(character)
	local originalColors = {}
	for index, obj in next, GLib.GetDescendants(character) do
		if obj:IsA'BasePart' then
			originalColors[obj] = {Property='BrickColor', Value=obj.BrickColor}
			obj.BrickColor = Config.IceColor.Value
			obj.Material = Config.IceMaterial.Value
			obj.Transparency = 0.5
			obj.Anchored = true
		elseif obj:IsA'FileMesh' then
			originalColors[obj] = {Property='VertexColor', Value=obj.VertexColor}
			obj.VertexColor = Vector3.new(Config.IceColor.Value.r, Config.IceColor.Value.g, Config.IceColor.Value.b)
		elseif obj:IsA'Smoke' or obj:IsA'Light' or obj:IsA'Fire' then
			originalColors[obj] = {Property='Color', Value=obj.Color}
			obj.Color = Config.IceColor.Value.Color
		elseif obj:IsA'Sparkles' then
			originalColors[obj] = {Property='SparkleColor', Value=obj.SparkleColor}
			obj.SparkleColor = Config.IceColor.Value.Color
		end
	end
	
	delay(2, function()
		GLib.TagHumanoid(GLib.GetHumanoid(character), GLib.GetPlayerFromPart(script), 1)
		character:BreakJoints()
		
		for obj, info in next, originalColors do
			obj[info.Property] = info.Value
			
			if obj:IsA'BasePart' then
				obj.Anchored = false
			end
		end
	end)
end

function Sword:Connect()
	Handle.Touched:connect(function(hit)
		local myPlayer = GLib.GetPlayerFromPart(Tool)
		local character, player, humanoid = GLib.GetCharacterFromPart(hit)
		
		if myPlayer~=nil and character~=nil and humanoid~=nil and myPlayer~=player then
			local isTeammate = GLib.IsTeammate(myPlayer, player)
			local myCharacter = myPlayer.Character
			local myHumanoid = myCharacter and myCharacter:FindFirstChild'Humanoid'
			
			if (Config.CanTeamkill.Value==true or isTeammate~=true) and (myHumanoid and myHumanoid:IsA'Humanoid' and myHumanoid.Health > 0) and (Config.CanKillWithForceField.Value or myCharacter:FindFirstChild'ForceField'==nil) then
				local isImmune = character:FindFirstChild'Firebrand'~=nil
				local freeze = not isImmune and character:FindFirstChild'ForceField'==nil and Sword.Active==true
				
				if freeze then
					Sword:Freeze(character)
				else
					if Sword.Active then -- not (isImmune and Sword.Active) then -- Previously Firebrand users are unaffected in its active state, currently Firebrand users take damage as if it were a regular sword.
						local doDamage = Config.IdleDamage.Value
						if Sword.State == 'Slashing' then
							doDamage = Config.SlashDamage.Value
						elseif Sword.State == 'Lunging' then
							doDamage = Config.LungeDamage.Value
						end
						
						GLib.TagHumanoid(humanoid, myPlayer, 1)
						humanoid:TakeDamage(doDamage)
					end
				end
			end
		end
	end)
	
	Tool.Equipped:connect(function()
		Sword.EquippedTicket = Sword.EquippedTicket+1
		local myEquippedTicket = Sword.EquippedTicket
		Sword:SetActive(false)
		
		delay(Config.ActiveDelay.Value, function()
			if Sword.EquippedTicket == myEquippedTicket then
				Sword:SetActive(true)
			end
		end)
	end)
	Tool.Unequipped:connect(function()
		Sword.EquippedTicket = Sword.EquippedTicket+1
		Sword:SetActive(false)
	end)
end

function Sword:SetActive(active)
	Sword.Active = active
	Handle.BrickColor = active and Config.ActiveSwordColor.Value or Config.InactiveSwordColor.Value
	Handle.Mesh.VertexColor = Vector3.new(Handle.BrickColor.r, Handle.BrickColor.g, Handle.BrickColor.b)
end

function Sword:Attack()
	local myCharacter, myPlayer, myHumanoid = GLib.GetCharacterFromPart(Tool)
	
	if myHumanoid~=nil and myHumanoid.Health > 0 then
		if Config.CanKillWithForceField.Value or myCharacter:FindFirstChild'ForceField'==nil then
			local now = tick()
			
			if Sword.State == 'Slashing' and now-Sword.SlashingStartedAt < Sword.DoubleClickMaxTime then
				Sword.AttackTicket = Sword.AttackTicket+1
				
				Sword:Lunge(Sword.AttackTicket)
			elseif Sword.State == 'Idle' then
				Sword.AttackTicket = Sword.AttackTicket+1
				Sword.SlashingStartedAt = now
				
				Sword:Slash(Sword.AttackTicket)
			end
		end
	end
end

function Sword:Slash(ticket)
	Sword.State = 'Slashing'
	
	Handle.SlashSound:Play()
	Sword:Animate'Slash'
	
	wait(0.5)
	
	if Sword.AttackTicket == ticket then
		Sword.State = 'Idle'
	end
end

function Sword:Lunge(ticket)
	Sword.State = 'Lunging'
	
	Handle.LungeSound:Play()
	Sword:Animate'Lunge'
	
	local force = Instance.new'BodyVelocity'
	force.velocity = Vector3.new(0, 10, 0)
	force.maxForce = Vector3.new(0, 4000, 0)
	force.Parent = Tool.Parent.Torso
	
	wait(0.25)
	Tool.GripForward = Vector3.new(0,0,1)
	Tool.GripRight = Vector3.new(0,-1,0)
	Tool.GripUp = Vector3.new(-1,0,0)
	wait(0.25)
	force:Destroy()
	wait(0.5)
	Tool.GripForward = Vector3.new(-1,0,0)
	Tool.GripRight = Vector3.new(0,1,0)
	Tool.GripUp = Vector3.new(0,0,1)
	
	Sword.State = 'Idle'
end

function Sword:Animate(name)
	local tag = Instance.new'StringValue'
	tag.Name = 'toolanim'
	tag.Value = name
	tag.Parent = Tool -- Tag gets removed by the animation script
end

--
function Sword:Initialize()
	Sword:Connect()
end

--
--
return Sword]]></ProtectedString>
			</Properties>
		</Item>
		<Item class="Configuration" referent="RBXD880F06335C54999974E8F66FD191013">
			<Properties>
				<string name="Name">Configurations</string>
			</Properties>
			<Item class="BoolValue" referent="RBX07831EF240384D4AAC9420D26578A7A3">
				<Properties>
					<string name="Name">CanTeamkill</string>
					<bool name="Value">false</bool>
				</Properties>
			</Item>
			<Item class="IntValue" referent="RBXB3234201144D45D286B653F2C0AA75FC">
				<Properties>
					<string name="Name">IdleDamage</string>
					<int name="Value">5</int>
				</Properties>
			</Item>
			<Item class="IntValue" referent="RBXC2FCDFC3152E48358C3EA53CE032D231">
				<Properties>
					<string name="Name">SlashDamage</string>
					<int name="Value">10</int>
				</Properties>
			</Item>
			<Item class="IntValue" referent="RBX5B7E5CFDD8454992B24E1BDBDC334FD7">
				<Properties>
					<string name="Name">LungeDamage</string>
					<int name="Value">15</int>
				</Properties>
			</Item>
			<Item class="BoolValue" referent="RBXA40A0BBD097842E6979652D813B8FEDD">
				<Properties>
					<string name="Name">CanKillWithForceField</string>
					<bool name="Value">true</bool>
				</Properties>
			</Item>
			<Item class="BrickColorValue" referent="RBX5F6BFE3A77DE45B5A25777C1D5D54F99">
				<Properties>
					<string name="Name">IceColor</string>
					<int name="Value">11</int>
				</Properties>
			</Item>
			<Item class="StringValue" referent="RBXCD1D7975A7E24A3690A630933FDC9BDB">
				<Properties>
					<string name="Name">IceMaterial</string>
					<string name="Value">Ice</string>
				</Properties>
			</Item>
			<Item class="BrickColorValue" referent="RBX2772BE99133B41D5B9A8EFED16A16E15">
				<Properties>
					<string name="Name">ActiveSwordColor</string>
					<int name="Value">23</int>
				</Properties>
			</Item>
			<Item class="BrickColorValue" referent="RBXABB51309FB8441D4B18E6F9D67ED0806">
				<Properties>
					<string name="Name">InactiveSwordColor</string>
					<int name="Value">1</int>
				</Properties>
			</Item>
			<Item class="NumberValue" referent="RBX1A74AD8C044F4F0588A1107153C92405">
				<Properties>
					<string name="Name">ActiveDelay</string>
					<double name="Value">3</double>
				</Properties>
			</Item>
		</Item>
		<Item class="Camera" referent="RBX020BC62E44FA493E90E0EE5ACE9D1FDA">
			<Properties>
				<Ref name="CameraSubject">null</Ref>
				<token name="CameraType">0</token>
				<CoordinateFrame name="CoordinateFrame">
					<X>-18.5833931</X>
					<Y>2.50875044</Y>
					<Z>-0.261957318</Z>
					<R00>-0.0151642617</R00>
					<R01>0.0241452791</R01>
					<R02>-0.999593496</R02>
					<R10>-0</R10>
					<R11>0.999708414</R11>
					<R12>0.0241480563</R12>
					<R20>0.999884963</R20>
					<R21>0.000366187451</R21>
					<R22>-0.0151598407</R22>
				</CoordinateFrame>
				<float name="FieldOfView">10</float>
				<CoordinateFrame name="Focus">
					<X>0.00747871399</X>
					<Y>2.05963445</Y>
					<Z>0.0199919641</Z>
					<R00>1</R00>
					<R01>0</R01>
					<R02>0</R02>
					<R10>0</R10>
					<R11>1</R11>
					<R12>0</R12>
					<R20>0</R20>
					<R21>0</R21>
					<R22>1</R22>
				</CoordinateFrame>
				<string name="Name">ThumbnailCamera</string>
			</Properties>
		</Item>
	</Item>
</roblox>